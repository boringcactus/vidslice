language: shell
if: tag IS present OR branch = build-fuckery
dist: bionic
os:
  - linux
  - osx
  - windows
addons:
  apt:
    packages:
      - python3.7
      - python3.7-dev
      - python3-pip
      - python3-setuptools
      - python3-tk
  homebrew:
    packages:
      - python@3.7
before_install:
  - chmod +x scripts/setup_${TRAVIS_OS_NAME}.sh
  - . scripts/setup_${TRAVIS_OS_NAME}.sh
install:
  - which python && export PYTHON=python || echo whatever
  - which python3 && export PYTHON=python3 || echo whatever
  - which python3.7 && export PYTHON=python3.7 || echo whatever
  - echo ${PYTHON}
  - ${PYTHON} -m pip install -r requirements.txt
script:
  - ${PYTHON} setup.py build
before_deploy:
  - ${PYTHON} setup.py build
  - pushd build
  - mv * vidslice
  - zip vidslice-${TRAVIS_OS_NAME}.zip -r vidslice || powershell Compress-Archive -Path vidslice -DestinationPath vidslice-${TRAVIS_OS_NAME}.zip
  - ls
  - popd
deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: "MEE1jkxa+YX50iYLrDHUUdW4anlDwhgT41quWqCCM2qRg3iY4qaN/BK5Q4XSd+h8RCf2gDRAU3wP6jA6cUrxFH6Nw/hszgvXN90A2Lhs2EG5HQ4bVOqzvsO13Zf8/Ha0PJyTXFSnRCdGUpSggcuJ3zbhSoU5xNO+Ch7WWcGraYuoCGS0Xl24LvQzWCb400C1tifx9ITDEinPYHR7objlRmmitvy6jhWmfiP2zeefTXAzLvYWhR3DpvsuzriVR79AVriRwnFP1yjpjfpvxnjqx+3GJEYmQy1SmaiQa8f9jK+agLyszefRoyquMu6j2pYTw9CPp7LC1WyVFHV1k0d74l2v9Yr2sVDqx6i131+9bhSD9D0OdL8A1RuPUlJUWy0FncfRUj3+rL3aCf+qO2kYS1gGeTD3A9RuaMYFsrrNqDtsLA1reF0nQ3eGqJ3HIaSyTFPt8EJ5bG8H2qErnGRz5E/TEDoZRY5rIyKwnIaPzoMLyRJGn7I/5ufvb0B06BNfhQLS4HrjqVTYFjM2ulbwTPLxmZH60hw/SAWpWFFhdbAWpNn7ezV9IBQEb2N+ovAPUgTbcWio1FYSZyB81NVgfL7V/aGIEmB0KNYvB6JL6VEaGV1BCf63X/5Nl7qxXZRBlGjwE893NKfNuxCjU0QC8voA3DwUXYmLr69PusyemtY="
  file_glob: true
  file: build/*.zip
  on:
    repo: boringcactus/vidslice
    tags: true
